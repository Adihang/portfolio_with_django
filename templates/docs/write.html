{% extends 'base.html' %}
{% block body_class %}docs-page{% endblock %}
{% block content %}
{% include 'docs/_assets_head.html' %}

<div class="docs-toolbar-wrap">
    <div class="docs-shell docs-toolbar">
        <div>
            <div class="docs-title-row">
                <h1 class="docs-title">{% if write_mode == 'edit' %}{{ docs_text.write_title_edit }}{% else %}{{ docs_text.write_title_create }}{% endif %}</h1>
            </div>
            <div class="docs-subtitle docs-path-breadcrumbs">
                {% for crumb in write_breadcrumbs %}
                    {% if not forloop.first %}<span class="docs-path-sep">/</span>{% endif %}
                    <a class="docs-path-link" href="{{ crumb.url }}">{{ crumb.label }}</a>
                {% endfor %}
                {% if write_current_file_name %}
                    <span class="docs-path-sep">/</span>
                    <span class="docs-path-current">{{ write_current_file_name }}</span>
                {% endif %}
            </div>
        </div>
        <div class="docs-toolbar-actions">
            {% include "docs/_auth_button.html" %}
            <button class="docs-btn" type="button" id="docs-markdown-help-btn">{{ docs_text.markdown_guide_button }}</button>
            <button class="docs-btn docs-btn-primary" type="button" id="docs-save-btn">{{ docs_text.save_button }}</button>
            <a class="docs-btn" href="{{ docs_base_url }}">{{ docs_text.list_button }}</a>
        </div>
    </div>
</div>

<main
    class="docs-shell docs-content"
    data-docs-page="write"
    data-docs-base-url="{{ docs_base_url }}"
    data-save-api-url="{{ docs_api_save_url }}"
    data-mkdir-api-url="{{ docs_api_mkdir_url }}"
    data-write-mode="{{ write_mode }}"
    data-original-path="{{ original_relative_path }}"
    data-ui-lang="{{ ui_lang|default:'ko' }}"
>
    <div class="docs-form-grid">
        <label class="docs-field docs-field-full">
            <span>{{ docs_text.filename_label }}</span>
            <input type="text" id="docs-filename-input" value="{{ initial_filename }}" placeholder="{{ docs_text.filename_placeholder }}">
        </label>

        <label class="docs-field docs-field-full">
            <span>{{ docs_text.content_label }}</span>
            <textarea id="docs-content-input" spellcheck="false">{{ initial_content }}</textarea>
        </label>
    </div>
</main>

<div id="docs-save-modal" class="docs-save-modal" hidden>
    <div class="docs-save-modal-backdrop" id="docs-save-modal-backdrop"></div>
    <div class="docs-save-modal-dialog" role="dialog" aria-modal="true" aria-labelledby="docs-save-modal-title">
        <div class="docs-save-modal-head">
            <h2 id="docs-save-modal-title" class="docs-save-modal-title">{{ docs_text.save_location_title }}</h2>
            <button type="button" class="docs-save-close-btn" id="docs-save-close-btn" aria-label="{{ docs_text.close_label }}">x</button>
        </div>
        <div class="docs-save-location-bar">
            <button type="button" class="docs-btn" id="docs-save-up-btn">{{ docs_text.up_button }}</button>
            <div class="docs-save-breadcrumb" id="docs-save-breadcrumb"></div>
        </div>
        <div class="docs-save-browser">
            <aside class="docs-save-sidebar">
                <div class="docs-save-sidebar-title">{{ docs_text.quick_paths_title }}</div>
                <ul class="docs-save-sidebar-list" id="docs-save-quick-list"></ul>
            </aside>
            <section class="docs-save-folder-pane">
                <div class="docs-save-folder-head">{{ docs_text.folder_title }}</div>
                <ul class="docs-save-folder-list" id="docs-save-folder-list"></ul>
            </section>
        </div>
        <label class="docs-field docs-field-full">
            <span>{{ docs_text.selected_path_label }}</span>
            <input type="text" id="docs-dir-input" list="docs-directory-options" value="{{ initial_dir }}" placeholder="{{ docs_text.selected_path_placeholder }}">
        </label>
        <div class="docs-save-modal-actions">
            <button type="button" class="docs-btn" id="docs-create-folder-btn">{{ docs_text.create_folder_button }}</button>
            <div class="docs-save-modal-actions-right">
                <button type="button" class="docs-btn" id="docs-save-cancel-btn">{{ docs_text.cancel }}</button>
                <button type="button" class="docs-btn docs-btn-primary" id="docs-save-confirm-btn">{{ docs_text.save_confirm_button }}</button>
            </div>
        </div>

        <div id="docs-folder-modal" class="docs-folder-modal" hidden>
            <div class="docs-folder-modal-backdrop" id="docs-folder-modal-backdrop"></div>
            <div class="docs-folder-modal-dialog" role="dialog" aria-modal="true" aria-labelledby="docs-folder-modal-title">
                <h3 id="docs-folder-modal-title" class="docs-folder-modal-title">{{ docs_text.folder_modal_title }}</h3>
                <div class="docs-folder-modal-path" id="docs-folder-target-path">/docs</div>
                <label class="docs-field docs-field-full">
                    <span>{{ docs_text.folder_name_label }}</span>
                    <input type="text" id="docs-folder-name-input" placeholder="{{ docs_text.folder_name_placeholder }}">
                </label>
                <div class="docs-folder-modal-actions">
                    <button type="button" class="docs-btn" id="docs-folder-cancel-btn">{{ docs_text.cancel }}</button>
                    <button type="button" class="docs-btn docs-btn-primary" id="docs-folder-create-btn">{{ docs_text.create_button }}</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="docs-markdown-help-modal" class="docs-help-modal" hidden>
    <div class="docs-help-modal-backdrop" id="docs-markdown-help-backdrop"></div>
    <div class="docs-help-modal-dialog" role="dialog" aria-modal="true" aria-label="{{ docs_text.markdown_help_aria }}">
        <div class="docs-help-modal-body">
            <article class="docs-markdown docs-help-markdown">{{ markdown_help_html }}</article>
        </div>
    </div>
</div>

<datalist id="docs-directory-options"></datalist>

{{ docs_text|json_script:"docs-i18n" }}
{{ available_directories|json_script:"docs-directory-data" }}
{% include 'docs/_assets_script.html' %}
{% endblock %}
