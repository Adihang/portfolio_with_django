# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Django-based portfolio website for showcasing projects, career history, and interactive mini-games. The site includes an AI-powered chatbot for answering portfolio-related questions using a local Ollama model.

## Development Commands

### Local Development
```bash
# Run development server
python manage.py runserver

# Install dependencies
pip3 install -r requirements.txt

# Apply database migrations
python manage.py migrate

# Create migrations after model changes
python manage.py makemigrations

# Collect static files
python manage.py collectstatic

# Create superuser for admin access
python manage.py createsuperuser
```

### Production Deployment
The project uses GitHub Actions for automated deployment to EC2. On push to `main`, the workflow:
1. SSHs into the EC2 instance
2. Pulls latest code
3. Installs dependencies
4. Collects static files
5. Runs migrations
6. Restarts gunicorn

Production is served via Gunicorn with the following command:
```bash
gunicorn config.wsgi:application
```

## Architecture

### Settings Management
- Main settings: `config/settings.py`
- Core app settings (`SECRET_KEY`, `OLLAMA_BASE_URL`, `OLLAMA_MODEL`) are currently defined directly in code.
- Set `DEBUG = False` in production (as configured in settings.py)

### URL Structure
- Root config: `config/urls.py` routes to main app
- Main app: `main/urls.py` defines all page routes
- Key endpoints:
  - `/portfolio/` - Main portfolio page
  - `/project/<id>/` - Project detail pages
  - `/Stratagem_Hero/` - Interactive game
  - `/api/chat/` - AI chatbot API endpoint

### Database Models (`main/models.py`)
- **Project**: Portfolio projects with tags, markdown content, banner images
- **Career**: Work experience with company, position, period
- **Hobby**: Personal interests with images
- **Stratagem**: Game data for Stratagem Hero mini-game
- **Stratagem_Hero_Score**: Leaderboard scores
- Custom `OrderField`: PositiveIntegerField with auto blank/null for manual ordering

All models use custom upload paths via `config/utils.py:make_new_path()` which generates UUID-based filenames.

### Views and Features (`main/views.py`)
- **Markdown rendering**: Project and career content is stored as markdown and rendered to HTML using the `markdown` library
- **Caching**: Website context for chatbot is cached for 24 hours using Django's cache framework
- **Chat Integration**: `chat_with_ai()` view provides AI assistant functionality with:
  - Input sanitization (removes HTML/JS, limits to 500 chars)
  - Portfolio context injection (projects, skills, contact info)
  - Prompt injection protection
  - Response validation
- **Static content**: Serves media files through Django in development via `re_path` in urls.py

### Template Structure
- Base template: `templates/base.html`
- Main sections: `templates/main/` (Careers, Hobbys, Projects, ProjectDetail)
- Fun pages: `templates/fun/` (Salvations_Edge_4, Vow_of_the_Disciple, Stratagem_Hero)
- Landing: `templates/none.html`

### Static and Media Files
- `static/`: Development static files
- `staticfiles/`: Production collected static files (generated by collectstatic)
- `media/`: User-uploaded content (project images, hobby images, etc.)
- Media URLs configured to serve via Django views in production

## Key Technical Details

### Database
- Uses SQLite (`db.sqlite3`) in both development and production
- Models use custom `OrderField` for manual ordering via admin interface

### Localization
- Language: Korean (`LANGUAGE_CODE = "ko-kr"`)
- Timezone: Asia/Seoul (`TIME_ZONE = "Asia/Seoul"`)

### Security Features
- CSRF protection enabled
- Trusted origins configured for HTTPS domains
- Secure proxy SSL header for load balancer compatibility
- Input sanitization in chat endpoint
- Prompt injection protection in chatbot system prompts

### Admin Interface
- Custom admin registrations for all models in `main/admin.py`
- Admin accessible at `/admin/`
- List displays configured for key models

### Dependencies
Key packages in requirements.txt:
- Django 4.2.24
- httpx 0.28.1 (Ollama API calls)
- gunicorn 23.0.0 (production server)
- Markdown 3.9 (content rendering)
- Pillow 11.3.0 (image handling)
- django-cors-headers 4.7.0

## Development Workflow

When modifying this codebase:

1. **Model changes**: Always run `makemigrations` and `migrate` after modifying models
2. **Static files**: Run `collectstatic` before deploying if static files changed
3. **Secrets**: Keep production secrets outside the repository and rotate any hardcoded local values before deployment
4. **Markdown content**: Project and Career content fields expect markdown syntax
5. **Image uploads**: All uploaded files use UUID-based filenames via `make_new_path()`
6. **Cache invalidation**: Website context cache persists 24 hours; clear manually if needed
7. **Production settings**: Ensure `DEBUG = False` and `ALLOWED_HOSTS` properly configured

## Notes

- The project uses a single Django app (`main`) for all functionality
- GitHub Actions workflow requires EC2 SSH secrets configured in repository settings
- Media files are served through Django (not recommended for high-traffic production)
- The chatbot has hardcoded context about the portfolio owner's skills and projects
